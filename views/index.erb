<!doctype html>
<html lang="en">
<head>
  <title>Opportunity Edits</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="Exony Salesforce Update Monitor" />
  <meta name="keywords" content="" />
  <meta name="author" content="Simon Stearn" />

  <link href="themes/rocket/jquery-wijmo.css" rel="stylesheet" type="text/css" title="rocket-jqueryui" />

  <script src="javascripts/jquery-1.7.1.min.js" type="text/javascript"></script>
  <script src="javascripts/jquery-ui-1.8.18.custom.min.js" type="text/javascript"></script>
  <script src="javascripts/globalize.min.js" type="text/javascript"></script>
  <script src="javascripts/raphael-min.js" type="text/javascript"></script>
  <script src="javascripts/jquery.wijmo.raphael.min.js" type="text/javascript"></script>
  <script src="javascripts/jquery.wijmo.wijchartcore.min.js" type="text/javascript"></script>
  <script src="javascripts/jquery.wijmo.wijlinechart.min.js" type="text/javascript"></script>
  <script id="scriptInit" type="text/javascript">
      $(document).ready(function () {
          $("#opportunityListChart").wijlinechart({
              showChartLabels: false,
              hint: {
                  content: function () {
                      return this.y;
                  },
                  offsetY: -10
              },
              header: {
                  text: "Opportunity Edits by User"
              },
              seriesList: [
                  <% first_entry = true
                    end_date = Date.new(Time.now.year, Time.now.month, Time.now.day)
                    @user_list.each do | user |     %>
                    <%= "," unless first_entry %>
                  {
                      label: "<%=user.to_s%>",
                      legendEntry: true,
                      data: {
                          x: [<%= @date_list %>],
                          y: [
                          <%  today = @earliest_date  %>
                          <%= @data[[today, user]].to_s %>
                          <%  today += 1
                              while (today <= end_date)  do  %>
                                  ,
                            <%= @data[[today, user]].to_s %>
                            <%  today += 1
                              end           %>
                                      ]
                                  },
                                  markers: {
                                      visible: true,
                                      type: "circle"
                                  }
                              },

                  <% first_entry = false
                     end %>
              ],

//              seriesStyles: [
//                  { stroke: "#00A0B0", "stroke-width": 3 },
//                  { stroke: "#CC333F", "stroke-width": 3 },
//                  { stroke: "#EB6841", "stroke-width": 3 },
//                  { stroke: "#EDC951", "stroke-width": 3 }
//              ],
//              seriesHoverStyles: [
//                  { "stroke-width": 4 },
//                  { "stroke-width": 4 },
//                  { "stroke-width": 4 },
//                  { "stroke-width": 4 }
//              ],
              axis: {
                  y: {
                  },
                  x: {
                      labels: {
                          style: {
                              rotation: -45
                          }
                      },
                      tickMajor: { position: "outside", style: { stroke: "#999999"} }
                  }
              }
          });
      });
  </script>
</head>
<body class="demo-single">
<div id="opportunityListChart" class="ui-widget ui-widget-content ui-corner-all" style="width: 800px; height: 600px"></div>
<div class="container">
  <div class="header">
    <h2>
      Opportunity Edits</h2>
  </div>
  <div class="main demo">
    <!-- Begin main markup -->
    <table id="opportunitylist" border="1">
      <caption>
        Number of edits per day by user (Opportunities only)
      </caption>
      <thead>
      <tr>
        <th>
          User
        </th>
        <th>
          Day
        </th>
        <th>
          Edit Count
        </th>
      </tr>
      </thead>

      <tbody>
      <% end_date = Date.new(Time.now.year, Time.now.month, Time.now.day)
         @user_list.each do | user |
           today = @earliest_date
           while (today <= end_date)  do
             record = @data[[today, user]] %>
              <tr>
                <th scope="row">
                  <%= user.to_s %>
                </th>
                <td>
                  <%= today.to_s %>
                </td>
                <td>
                  <%= record.to_s %>
                </td>
              </tr>
        <%   today += 1
           end
         end %>
      </tbody>
    </table>
    <!-- End  markup -->
    <div class="demo-options">
      <!-- Begin options markup -->
      <!-- End options markup -->
    </div>
  </div>
  <div class="footer demo-description">
    <p>
      Data taken from salesforce.com at <%= DateTime.now().to_s %>. </p>
  </div>
</div>

<a href="logout" id="logout">Logout</a>

</body>
</html>